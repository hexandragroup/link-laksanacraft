<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cari Produk - Laksana Handicraft</title>
  <meta name="description" content="Pencarian Produk Laksana Handicraft" />

  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(to bottom, #eeeeee, #cccccc);
      padding: 30px;
      margin: 0;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #f2f2f2;
      padding: 22px;
      border-radius: 14px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      text-align: center;
    }
    img.logo { width: 100px; border-radius:50%; margin-bottom:12px; }
    h1 { font-size:20px; margin:6px 0 12px; }
    p.lead { color:#444; margin-bottom:18px; }

    /* tombol / select gaya link.laksanacraft */
    .btn {
      display:block;
      width:100%;
      max-width:420px;
      margin:10px auto;
      padding:12px 14px;
      background:#fff;
      color:#222;
      border-radius:8px;
      border:1px solid #bbb;
      text-decoration:none;
      cursor:pointer;
      transition:all .18s ease;
      box-sizing:border-box;
    }
    .btn:hover { background:#eaeaea; transform:scale(1.02); }

    form .input-row { margin-top:12px; }
    select, button, input[type=text] {
      width:100%;
      max-width:420px;
      padding:10px;
      border-radius:8px;
      border:1px solid #bbb;
      box-sizing:border-box;
      margin:6px auto;
    }
    button[type="submit"] { background:#333; color:#fff; border:none; cursor:pointer; padding:12px; }

    #results { margin-top:18px; text-align:left; }
    .result {
      background:#fff; border:1px solid #ddd; padding:12px; border-radius:8px; margin-bottom:12px;
    }
    .result p { margin:6px 0; }
    .small { font-size:13px; color:#666; }

    /* fix google translate visual side-effects */
    html, body {
      height:100% !important;
      background: linear-gradient(to bottom, #eeeeee, #cccccc) !important;
      background-attachment: fixed !important;
      background-repeat: no-repeat !important;
      background-size: cover !important;
    }
    .goog-te-banner-frame.skiptranslate { display:none !important; }
    body { top:0 !important; }
    .goog-te-gadget-icon { display:none !important; }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://raw.githubusercontent.com/hexandragroup/laksanacraft-assets/main/Logo_Laksana_Handicraft.png" alt="Logo" class="logo" />
    <h1>Pencarian Produk Laksana Handicraft</h1>
    <p class="lead"><em>Kerajinan Nusantara, Warisan Dunia</em></p>

    <!-- Dropdown Translate (tampilan sama seperti link.laksana) -->
    <div style="max-width:420px;margin:0 auto 8px;">
      <select class="btn" id="translateSelect" onchange="doGTranslate(this);">
        <option value="">🌏 Pilih Bahasa</option>
        <option value="id|id">🇮🇩 Indonesia</option>
        <option value="id|en">🇬🇧 English</option>
        <option value="id|ms">🇲🇾 Melayu</option>
        <option value="id|ja">🇯🇵 日本語</option>
        <option value="id|zh-CN">🇨🇳 中文</option>
        <option value="id|ar">🇸🇦 العربية</option>
        <option value="id|fr">🇫🇷 Français</option>
        <option value="id|de">🇩🇪 Deutsch</option>
        <option value="id|es">🇪🇸 Español</option>
      </select>
    </div>

    <!-- Form Pencarian -->
    <form id="searchForm">
      <div class="input-row">
        <label class="small" for="tokoh">Nama Tokoh</label>
        <select id="tokoh">
          <option value="">-- Pilih Tokoh --</option>
          <option>Arjuna</option>
          <option>Bima</option>
          <option>Puntadewa</option>
          <option>Nakula</option>
          <option>Sadewa</option>
          <option>Custom Tokoh</option>
        </select>
      </div>

      <div class="input-row">
        <label class="small" for="ukuran">Ukuran Produk</label>
        <select id="ukuran">
          <option value="">-- Pilih Ukuran --</option>
          <option>Miniatur</option>
          <option>20cm</option>
          <option>25cm</option>
          <option>30cm</option>
          <option>Standar Pedalangan</option>
        </select>
      </div>

      <div class="input-row">
        <label class="small" for="kualitas">Kualitas Produk</label>
        <select id="kualitas">
          <option value="">-- Pilih Kualitas --</option>
          <option>Murah</option>
          <option>Alusan</option>
        </select>
      </div>

      <div style="margin-top:12px;">
        <button type="submit">Cari Produk</button>
      </div>
    </form>

    <div id="results"></div>

    <p class="small" style="margin-top:18px;">&copy; Laksana Handicraft</p>
  </div>

  <!-- hidden element for Google Translate (required) -->
  <div id="google_translate_element" style="display:none;"></div>

  <script>
    // ----- products.json loading (TIDAK MERUBAH data produk) -----
    let products = [];
    fetch("products.json")
      .then(r => {
        if (!r.ok) throw new Error("products.json tidak ditemukan");
        return r.json();
      })
      .then(data => products = data)
      .catch(err => {
        console.error(err);
        document.getElementById("results").innerHTML = "<p style='color:red;'>Gagal memuat data produk (products.json).</p>";
      });

    // ----- pencarian (cukup pilih satu) -----
    document.getElementById("searchForm").addEventListener("submit", function(e){
      e.preventDefault();
      const tokoh = document.getElementById("tokoh").value;
      const ukuran = document.getElementById("ukuran").value;
      const kualitas = document.getElementById("kualitas").value;
      const out = document.getElementById("results");
      out.innerHTML = "";

      if (!tokoh && !ukuran && !kualitas) {
        out.innerHTML = "<p style='color:red;'>⚠️ Silakan pilih minimal satu kriteria pencarian.</p>";
        return;
      }

      const filtered = products.filter(p =>
        (tokoh ? p.tokoh === tokoh : true) &&
        (ukuran ? p.ukuran === ukuran : true) &&
        (kualitas ? p.kualitas === kualitas : true)
      );

      if (filtered.length === 0) {
        out.innerHTML = "<p>Tidak ada produk ditemukan.</p>";
        return;
      }

      // tampilkan hasil
      filtered.forEach(p => {
        if (p.varian && Array.isArray(p.varian)) {
          p.varian.forEach(v => {
            out.innerHTML += `
              <div class="result">
                <p><strong>Tokoh:</strong> ${escapeHtml(p.tokoh)}</p>
                <p><strong>Ukuran:</strong> ${escapeHtml(p.ukuran)} (${escapeHtml(v.size)})</p>
                <p><strong>Kualitas:</strong> ${escapeHtml(p.kualitas)}</p>
                <p><strong>Harga:</strong> ${escapeHtml(v.harga)}</p>
                <p><a href="${escapeAttr(v.link)}" target="_blank">🔗 Detail Produk</a></p>
              </div>
            `;
          });
        } else {
          out.innerHTML += `
            <div class="result">
              <p><strong>Tokoh:</strong> ${escapeHtml(p.tokoh)}</p>
              <p><strong>Ukuran:</strong> ${escapeHtml(p.ukuran)}</p>
              <p><strong>Kualitas:</strong> ${escapeHtml(p.kualitas)}</p>
              <p><strong>Harga:</strong> ${escapeHtml(p.harga || '-')}</p>
              <p><a href="${escapeAttr(p.link)}" target="_blank">🔗 Detail Produk</a></p>
            </div>
          `;
        }
      });
    });

    // small helpers to avoid XSS if someone injects data
    function escapeHtml(s){ return (s===undefined||s===null) ? '' : String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); }); }
    function escapeAttr(s){ return escapeHtml(s); }

    // ----- Google Translate integration (robust) -----
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({pageLanguage: 'id', autoDisplay: false}, 'google_translate_element');
    }

    function setCookie(name, value, days, domain){
      var expires = "";
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
      }
      var domainPart = domain ? "; domain=" + domain : "";
      document.cookie = name + "=" + (value || "")  + expires + "; path=/" + domainPart;
    }

    function doGTranslate(el) {
      if (!el || !el.value) return;
      var langPair = el.value.split('|');
      var lang = langPair[1];

      // jika pilih Indonesia -> reset translate
      if (lang === 'id') {
        // hapus cookie googtrans (best effort)
        setCookie('googtrans', '', -1, window.location.hostname);
        setCookie('googtrans', '', -1);
        // reload untuk menerapkan
        location.reload();
        return;
      }

      // coba cari select internal google
      var tries = 0;
      function applyToInternal() {
        var combo = document.querySelector('.goog-te-combo');
        if (combo) {
          combo.value = lang;
          combo.dispatchEvent(new Event('change'));
        } else {
          tries++;
          if (tries < 10) {
            setTimeout(applyToInternal, 300);
          } else {
            // fallback: set cookie dan reload
            setCookie('googtrans', '/id/' + lang, 1, window.location.hostname);
            setCookie('googtrans', '/id/' + lang, 1);
            location.reload();
          }
        }
      }
      applyToInternal();
    }
  </script>

  <!-- Google Translate API (callback) -->
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>