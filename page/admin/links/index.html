<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kelola Link â€” LaksanaCraft</title>
<link rel="stylesheet" href="/assets/style/style.css">
<style>
.container-box { max-width:900px; margin:30px auto; background:#fff; padding:25px; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
h1 { text-align:center; margin-bottom:20px; }
.link-item { border:1px solid #ddd; border-radius:12px; padding:15px; margin-bottom:12px; background:#fafafa; }
.link-controls { margin-top:12px; display:flex; gap:10px; }
.btn-small { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; color:#fff; }
.btn-edit { background:#0288d1; } .btn-edit:hover { background:#039be5; }
.btn-delete { background:#d32f2f; } .btn-delete:hover { background:#e53935; }
.btn-add { display:block; width:100%; padding:12px; margin-bottom:20px; background:#3f51b5; color:#fff; border-radius:10px; border:none; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<script src="/assets/script/corner-menu.js"></script>

<div class="container-box">
    <h1>Kelola Link</h1>
    <button class="btn-add" onclick="location.href='add.html'">+ Tambah Link</button>
    <div id="list">Memuat data...</div>
</div>

<script>
const API = "https://api.laksanacraft.my.id"; 
const TOKEN = localStorage.getItem("GH_TOKEN");
if(!localStorage.getItem("isLoggedIn")) location.href="/page/login.html";

// ----------------------
// LOAD LINKS
// ----------------------
async function loadLinks() {
    const el = document.getElementById("list");
    el.innerHTML = "Memuat data...";

    try {
        const res = await fetch(`${API}/links`);
        const arr = await res.json();
        el.innerHTML = "";

        arr.forEach((item, i) => {
            const div = document.createElement("div");
            div.className = "link-item";
            div.innerHTML = `
                <p><strong>Kategori:</strong> ${item.category}</p>
                <p><strong>Judul:</strong> ${item.title}</p>
                <p><strong>URL:</strong> <a href="${item.url}" target="_blank">${item.url}</a></p>
                <p><strong>Icon:</strong> ${item.icon}</p>
                <div class="link-controls">
                    <button class="btn-small btn-edit" onclick="editLink(${i})">Edit</button>
                    <button class="btn-small btn-delete" onclick="deleteLink(${i})">Hapus</button>
                </div>
            `;
            el.appendChild(div);
        });

    } catch (e) {
        el.innerHTML = "Gagal memuat data.";
        console.error(e);
    }
}

// ----------------------
// EDIT LINK
// ----------------------
function editLink(i) {
    location.href = `edit.html?id=${i}`;
}

// ----------------------
// DELETE LINK
// ----------------------
async function deleteLink(i) {
    if(!confirm("Yakin ingin menghapus link ini?")) return;

    try {
        const res = await fetch(`${API}/links?id=${i}`, {
            method: "DELETE",
            headers: { "Authorization": `token ${TOKEN}` }
        });
        if (res.ok) {
            alert("Link dihapus.");
            loadLinks();
        } else {
            alert("Gagal menghapus link.");
        }
    } catch(e) {
        alert("Kesalahan koneksi saat menghapus.");
        console.error(e);
    }
}

// ----------------------
// INIT
// ----------------------
loadLinks();
</script>

</body>
</html>