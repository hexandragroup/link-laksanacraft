<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Demo â€” LaksanaCraft</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
<h3>LaksanaCraft Admin Demo</h3>
<ul class="nav nav-tabs mt-3">
<li class="nav-item"><a class="nav-link active" href="#" onclick="switchTab('products')">Produk</a></li>
<li class="nav-item"><a class="nav-link" href="#" onclick="switchTab('links')">Links</a></li>
</ul>

<div class="mt-3">
<label>Pilih file JSON:</label>
<select id="fileSelect" class="form-select w-auto d-inline-block" onchange="loadFile()"></select>
</div>

<div class="mt-3" id="dataContainer">
<table class="table table-bordered bg-white">
<thead id="tableHead"></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

<script>
const API_BASE = "https://ancient-king-d447.hendraslaksono.workers.dev";
let currentTab="products",currentFile="",currentData=[];

window.onload = async()=>{
  if(!localStorage.getItem("isLoggedIn")) location.href="../login/index.html";
  await loadList();
}

async function loadList(){
  const res = await fetch(`${API_BASE}/list?type=${currentTab}`);
  const files = await res.json();
  if(!Array.isArray(files)) return;
  fileSelect.innerHTML = files.map(f=>`<option value="${f}">${f}</option>`).join('');
  if(files.length>0){ currentFile = files[0]; await loadFile(); }
}

async function loadFile(){
  if(!currentFile) currentFile = fileSelect.value;
  const res = await fetch(`${API_BASE}/${currentTab}?file=${currentFile}`);
  currentData = await res.json();
  renderTable();
}

function renderTable(){
  if(currentData.length===0){ tableHead.innerHTML=''; tableBody.innerHTML=''; return; }
  const cols = Object.keys(currentData[0]);
  tableHead.innerHTML = '<tr>'+cols.map(c=>`<th>${c}</th>`).join('')+'</tr>';
  tableBody.innerHTML = currentData.map(row=>'<tr>'+cols.map(c=>`<td>${row[c]}</td>`).join('')+'</tr>').join('');
}

function switchTab(tab){
  currentTab = tab;
  document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
  event.target.classList.add('active');
  loadList();
}
</script>
</body>
</html>