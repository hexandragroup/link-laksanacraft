<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin Panel â€” LaksanaCraft</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
.nav-tabs .nav-link.active { background-color:#fff !important; border-bottom:2px solid #0d6efd; }
.table td, .table th { vertical-align: middle; }
</style>
</head>
<body>
<div class="container py-4">
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>LaksanaCraft Admin</h3>
  <button class="btn btn-outline-danger btn-sm" onclick="logout()">Logout</button>
</div>

<ul class="nav nav-tabs">
  <li class="nav-item"><a class="nav-link active" href="#" onclick="switchTab('products')">Produk</a></li>
  <li class="nav-item"><a class="nav-link" href="#" onclick="switchTab('links')">Links</a></li>
</ul>

<div class="mt-3">
  <label>Pilih file JSON:</label>
  <select id="fileSelect" class="form-select w-auto d-inline-block" onchange="loadFile()"></select>
</div>

<div class="mt-3" id="dataContainer">
  <table class="table table-bordered bg-white">
    <thead><tr id="tableHead"></tr></thead>
    <tbody id="tableBody"></tbody>
  </table>
  <button class="btn btn-primary" onclick="addItem()">Tambah Item</button>
</div>
</div>

<script>
const API_BASE = "https://ancient-king-d447.hendraslaksono.workers.dev";
let currentTab="products",currentFile="",currentData=[];

window.onload = async()=>{
  if(!localStorage.getItem("isLoggedIn")) location.href="../login/index.html";
  await loadList();
}

async function loadList(){
  const res = await fetch(`${API_BASE}/list?type=${currentTab}`);
  const files = await res.json();
  fileSelect.innerHTML = files.map(f=>`<option value="${f}">${f}</option>`).join('');
  if(files.length>0){ currentFile = files[0]; await loadFile(); }
}

async function loadFile(){
  currentFile = fileSelect.value;
  const res = await fetch(`${API_BASE}/${currentTab}?file=${currentFile}`);
  currentData = await res.json();
  renderTable();
}

function renderTable(){
  let cols = Object.keys(currentData[0]||{});
  tableHead.innerHTML = cols.map(c=>`<th>${c}</th>`).join('') + "<th>Aksi</th>";
  tableBody.innerHTML = currentData.map((row,i)=>`<tr>${
    cols.map(c=>`<td contenteditable data-key="${c}" data-index="${i}">${row[c]}</td>`).join('')
  }<td><button class='btn btn-sm btn-danger' onclick='deleteItem(${i})'>Hapus</button></td></tr>`).join('');
}

function addItem(){
  if(currentData.length===0){alert('Tidak ada data untuk ditiru'); return;}
  let newRow = {...currentData[0]};
  Object.keys(newRow).forEach(k=>newRow[k]='');
  currentData.push(newRow);
  renderTable();
}

function deleteItem(i){
  if(confirm('Yakin hapus item ini?')){
    currentData.splice(i,1);
    renderTable();
  }
}

function switchTab(tab){
  currentTab = tab;
  document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
  event.target.classList.add('active');
  loadList();
}

function logout(){
  localStorage.removeItem('isLoggedIn');
  localStorage.removeItem('LaksanaCraft_API_KEY');
  location.href="../login/index.html";
}
</script>
</body>
</html>