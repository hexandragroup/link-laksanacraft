<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

  <h3 class="mb-4">Admin Panel</h3>

  <!-- TAB -->
  <ul class="nav nav-tabs mb-3" id="tabs">
    <li class="nav-item">
      <button class="nav-link active" onclick="setTab('products')">Products</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" onclick="setTab('links')">Links</button>
    </li>
  </ul>

  <!-- Dropdown file -->
  <select class="form-select mb-3" id="fileSelect" onchange="loadFile()">
  </select>

  <!-- Table -->
  <table class="table table-bordered bg-white">
    <thead id="thead"></thead>
    <tbody id="tbody"></tbody>
  </table>

</div>

<script>
const API = "https://ancient-king-d447.hendraslaksono.workers.dev";

let currentTab = "products";

const files = {
  products: ["products1.json","products2.json","products3.json"],
  links: ["data1.json","data2.json","data3.json"]
};

function setTab(tab){
  currentTab = tab;
  renderFileList();
  loadFile();
}

function renderFileList(){
  fileSelect.innerHTML = "";
  files[currentTab].forEach(f=>{
    fileSelect.innerHTML += `<option>${f}</option>`;
  });
}

async function loadFile(){
  let file = fileSelect.value;
  let res = await fetch(`${API}/${currentTab}?file=${file}`);
  let out = await res.json();

  renderTable(out);
}

function renderTable(arr){
  if(!Array.isArray(arr)) return;

  if(currentTab === "products"){
    thead.innerHTML = `<tr><th>ID</th><th>Tokoh</th><th>Ukuran</th><th>Kualitas</th></tr>`;
    tbody.innerHTML = arr.map(x=>`
      <tr>
        <td>${x.id}</td>
        <td>${x.tokoh}</td>
        <td>${x.ukuran}</td>
        <td>${x.kualitas}</td>
      </tr>
    `).join("");
  }

  if(currentTab === "links"){
    thead.innerHTML = `<tr><th>ID</th><th>Nama</th><th>URL</th></tr>`;
    tbody.innerHTML = arr.map(x=>`
      <tr>
        <td>${x.id}</td>
        <td>${x.name}</td>
        <td>${x.url}</td>
      </tr>
    `).join("");
  }
}

// INIT
if(localStorage.getItem("logged") !== "yes") location.href="login/";
renderFileList();
loadFile();
</script>

</body>
</html>