<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
<h3>Admin Panel</h3>

<ul class="nav nav-tabs mt-3">
<li class="nav-item"><a class="nav-link active" href="#" onclick="switchTab('products', event)">Produk</a></li>
<li class="nav-item"><a class="nav-link" href="#" onclick="switchTab('links', event)">Links</a></li>
</ul>

<div class="mt-3">
<select id="fileSelect" class="form-select w-auto d-inline-block" onchange="loadFile()"></select>
</div>

<div class="mt-3" style="overflow:auto;max-height:400px;background:white;padding:10px;border-radius:6px;">
<table class="table table-bordered table-striped">
<thead id="tableHead"></thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

<script>
const API_BASE="https://ancient-king-d447.hendraslaksono.workers.dev";
let currentTab="products";
let currentFile="";
let currentData=[];

window.onload = async()=>{
  if(!localStorage.getItem("isLoggedIn")) location.href="../login/index.html";
  switchTab(currentTab, {target: document.querySelector(".nav-link")});
}

async function switchTab(tab,e){
  currentTab=tab;
  document.querySelectorAll(".nav-link").forEach(l=>l.classList.remove("active"));
  e.target.classList.add("active");

  currentFile = tab==="products" ? "products1.json" : "data1.json";
  const fileSelect=document.getElementById("fileSelect");
  fileSelect.innerHTML=`<option value="${currentFile}">${currentFile}</option>`;

  await loadFile();
}

async function loadFile(){
  const res = await fetch(`${API_BASE}/${currentTab}?file=${currentFile}`);
  const j = await res.json();
  if(j.error){ alert(j.error); currentData=[]; } else currentData=j;
  renderTable();
}

function renderTable(){
  const thead=document.getElementById("tableHead");
  const tbody=document.getElementById("tableBody");
  if(!Array.isArray(currentData)||currentData.length===0){ thead.innerHTML=''; tbody.innerHTML=''; return; }

  const cols=Object.keys(currentData[0]);
  thead.innerHTML="<tr>"+cols.map(c=>`<th>${c}</th>`).join("")+"</tr>";
  tbody.innerHTML=currentData.map(row=>"<tr>"+cols.map(c=>`<td>${row[c]}</td>`).join("")+"</tr>").join("");
}
</script>
</body>
</html>