<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Panel — LaksanaCraft (Final)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background:#eef1f6; }
    .modal input { margin-bottom:10px; }
  </style>
</head>
<body class="py-4 bg-light">
<div class="container">  <!-- HEADER -->  <div class="card mb-4"><div class="card-body d-flex justify-content-between">
    <h4 class="mb-0">Admin Panel</h4>
    <button class="btn btn-danger" onclick="logout()">Logout</button>
  </div></div>  <!-- TABS -->  <div class="card mb-4"><div class="card-body"><ul class="nav nav-tabs mb-3">
  <li class="nav-item"><button class="nav-link active" data-tab="produk">Produk</button></li>
  <li class="nav-item"><button class="nav-link" data-tab="links">Links</button></li>
</ul>

<div class="mb-3">
  <label class="form-label fw-bold">Pilih File JSON</label>
  <select id="fileSelect" class="form-select"></select>
</div>

<div class="d-flex justify-content-between mb-2">
  <h6 class="fw-bold">Daftar Item</h6>
  <button class="btn btn-success" id="btnAdd">Tambah Item</button>
</div>

<table class="table table-striped" id="dataTable">
  <thead><tr id="theadRow"></tr></thead>
  <tbody id="tbodyData"></tbody>
</table>

  </div></div></div><!-- MODAL FORM --><div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">Edit Item</h5></div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button class="btn btn-primary" id="saveBtn">Simpan</button>
      </div>
    </div>
  </div>
</div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script><script>
let currentTab = 'produk';
let data = [];
let editingIndex = null;

let structure = {
  produk: ['id','tokoh','ukuran','kualitas'],
  links: ['id','title','url']
};

let files = {
  produk: ['products1.json','products2.json','products3.json'],
  links: ['data1.json','data2.json','data3.json']
};

// TAB SWITCH
for (let btn of document.querySelectorAll('[data-tab]')){
  btn.onclick = ()=>{
    document.querySelectorAll('[data-tab]').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    currentTab = btn.dataset.tab;
    loadFileList();
  };
}

function loadFileList(){
  fileSelect.innerHTML = '';
  files[currentTab].forEach(f=>{
    const o = document.createElement('option'); o.value=f; o.textContent=f;
    fileSelect.appendChild(o);
  });
  loadFile();
}

function loadFile(){
  // DEMO DATA — nanti sebenarnya fetched dari Worker
  data = currentTab==='produk'
    ? [{id:1,tokoh:'Arjuna',ukuran:'30cm',kualitas:'Alusan'}]
    : [{id:1,title:'Tokopedia',url:'https://tokopedia.com'}];
  renderTable();
}

function renderTable(){
  const head = structure[currentTab];
  theadRow.innerHTML = head.map(h=>`<th>${h}</th>`).join('')+`<th>Aksi</th>`;
  tbodyData.innerHTML = '';

  data.forEach((row,i)=>{
    const tr = document.createElement('tr');
    head.forEach(h=>{ tr.innerHTML += `<td>${row[h]}</td>` });
    tr.innerHTML += `
      <td>
        <button class='btn btn-warning btn-sm me-1' onclick='openEdit(${i})'>Edit</button>
        <button class='btn btn-danger btn-sm' onclick='deleteItem(${i})'>Hapus</button>
      </td>`;
    tbodyData.appendChild(tr);
  });
}

btnAdd.onclick = ()=>{
  editingIndex = null;
  openModal(createEmptyItem());
};

function openEdit(i){
  editingIndex = i;
  openModal({...data[i]});
}

function deleteItem(i){
  if(confirm('Hapus item ini?')){
    data.splice(i,1);
    renderTable();
  }
}

function createEmptyItem(){
  let obj = {}; structure[currentTab].forEach(k=>obj[k]='');
  return obj;
}

function openModal(obj){
  modalBody.innerHTML = '';
  for(const k of structure[currentTab]){
    modalBody.innerHTML += `
      <label class='form-label'>${k}</label>
      <input class='form-control' id='fld_${k}' value='${obj[k] ?? ''}'>
    `;
  }
  const m = new bootstrap.Modal(editModal); m.show();
}

saveBtn.onclick = ()=>{
  let obj={};
  structure[currentTab].forEach(k=>{
    obj[k] = document.getElementById('fld_'+k).value;
  });

  if(editingIndex===null) data.push(obj);
  else data[editingIndex] = obj;

  renderTable();
  bootstrap.Modal.getInstance(editModal).hide();
};

function logout(){ location.href='/login/'; }

loadFileList();
</script></body>
</html>