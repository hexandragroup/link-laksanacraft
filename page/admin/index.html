<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin â€” LaksanaCraft</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#f4f6fb; padding:20px; }
.table-container { max-height:500px; overflow:auto; background:white; padding:10px; border-radius:6px; }
</style>
</head>
<body>

<div class="container">
  <h3>LaksanaCraft Admin Panel</h3>

  <ul class="nav nav-tabs mt-3">
    <li class="nav-item">
      <a class="nav-link active" href="#" onclick="switchTab('products', event)">Produk</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="switchTab('links', event)">Links</a>
    </li>
  </ul>

  <div class="mt-3">
    <label>Pilih file JSON:</label>
    <select id="fileSelect" class="form-select w-auto d-inline-block" onchange="loadFile()"></select>
  </div>

  <div class="table-container mt-3">
    <table class="table table-bordered table-striped">
      <thead id="tableHead"></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
const API_BASE = "https://ancient-king-d447.hendraslaksono.workers.dev";
let currentTab="products";
let currentFile="";
let currentData=[];

// redirect jika belum login
window.onload = async()=>{
  if(!localStorage.getItem("isLoggedIn")) location.href="../login/index.html";
  await initFiles();
}

// setup default files untuk dropdown
async function initFiles(){
  if(currentTab==="products") currentFile="products1.json";
  if(currentTab==="links") currentFile="data1.json";

  const fileSelect = document.getElementById("fileSelect");
  fileSelect.innerHTML = `<option value="${currentFile}">${currentFile}</option>`;
  
  await loadFile();
}

// load file JSON dari Worker
async function loadFile(){
  const res = await fetch(`${API_BASE}/${currentTab}?file=${currentFile}`);
  const j = await res.json();
  if(j.error){
    alert(`Error loading ${currentFile}: ${j.error}`);
    currentData=[];
  } else currentData = j;
  renderTable();
}

// render tabel
function renderTable(){
  const thead = document.getElementById("tableHead");
  const tbody = document.getElementById("tableBody");
  if(!Array.isArray(currentData) || currentData.length===0){
    thead.innerHTML=""; tbody.innerHTML=""; return;
  }

  const cols = Object.keys(currentData[0]);
  thead.innerHTML = "<tr>" + cols.map(c=>`<th>${c}</th>`).join("") + "</tr>";
  tbody.innerHTML = currentData.map(row=>{
    return "<tr>" + cols.map(c=>`<td>${row[c]}</td>`).join("") + "</tr>";
  }).join("");
}

// switch tab
function switchTab(tab, e){
  currentTab = tab;
  document.querySelectorAll(".nav-link").forEach(l=>l.classList.remove("active"));
  e.target.classList.add("active");

  if(tab==="products") currentFile="products1.json";
  if(tab==="links") currentFile="data1.json";

  const fileSelect = document.getElementById("fileSelect");
  fileSelect.innerHTML = `<option value="${currentFile}">${currentFile}</option>`;
  
  loadFile();
}
</script>
</body>
</html>