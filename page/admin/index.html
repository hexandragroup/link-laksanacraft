<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin â€” LaksanaCraft</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#f4f6fb; padding:20px; }
.table-container { max-height:500px; overflow:auto; background:white; padding:10px; border-radius:6px; }
</style>
</head>
<body>

<div class="container">
  <h3>LaksanaCraft Admin Panel</h3>

  <ul class="nav nav-tabs mt-3">
    <li class="nav-item">
      <a class="nav-link active" href="#" onclick="switchTab('products', event)">Produk</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="#" onclick="switchTab('links', event)">Links</a>
    </li>
  </ul>

  <div class="mt-3">
    <label>Pilih file JSON:</label>
    <select id="fileSelect" class="form-select w-auto d-inline-block" onchange="loadFile()"></select>
  </div>

  <div class="table-container mt-3">
    <table class="table table-bordered table-striped">
      <thead id="tableHead"></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
const API_BASE = "https://ancient-king-d447.hendraslaksono.workers.dev";
let currentTab="products";
let currentFile="";
let currentData=[];
const files = {
  products: ["products1.json","products2.json"],
  links: ["data1.json","data2.json","data3.json","data4.json","data5.json"]
};

// redirect jika belum login
window.onload = async()=>{
  if(!localStorage.getItem("isLoggedIn")) location.href="../login/index.html";
  setupFiles();
}

function setupFiles(){
  const fileSelect = document.getElementById("fileSelect");
  currentFile = files[currentTab][0];
  fileSelect.innerHTML = files[currentTab].map(f=>`<option value="${f}">${f}</option>`).join("");
  loadFile();
}

async function loadFile(){
  const fileSelect = document.getElementById("fileSelect");
  currentFile = fileSelect.value;
  try {
    const res = await fetch(`${API_BASE}/${currentTab}?file=${currentFile}`);
    const j = await res.json();
    if(j.error){ alert(`Error loading ${currentFile}: ${j.error}`); currentData = []; }
    else currentData = Array.isArray(j) ? j : [j];
  } catch(e){ alert(`Fetch error: ${e.message}`); currentData = []; }
  renderTable();
}

function renderTable(){
  const thead = document.getElementById("tableHead");
  const tbody = document.getElementById("tableBody");
  if(!currentData.length){ thead.innerHTML=""; tbody.innerHTML=""; return; }

  const cols = Object.keys(currentData[0]);
  thead.innerHTML = "<tr>" + cols.map(c=>`<th>${c}</th>`).join("") + "</tr>";
  tbody.innerHTML = currentData.map(row=>{
    return "<tr>" + cols.map(c=>{
      let val = row[c];
      if(Array.isArray(val)) val = JSON.stringify(val);
      return `<td>${val}</td>`;
    }).join("") + "</tr>";
  }).join("");
}

function switchTab(tab, e){
  currentTab = tab;
  document.querySelectorAll(".nav-link").forEach(l=>l.classList.remove("active"));
  e.target.classList.add("active");

  const fileSelect = document.getElementById("fileSelect");
  fileSelect.innerHTML = files[tab].map(f=>`<option value="${f}">${f}</option>`).join("");
  loadFile();
}
</script>
</body>
</html>