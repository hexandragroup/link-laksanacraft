<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tambah Produk — Admin</title>

<link rel="stylesheet" href="/assets/style/style.css">

<style>
.container-box { 
  max-width:720px; 
  margin:30px auto; 
  background:#fff; 
  padding:28px; 
  border-radius:12px; 
  box-shadow:0 8px 22px rgba(0,0,0,.06);
}
h1 { text-align:center; }

.form-row { display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
.form-row .col { flex:1; min-width:120px; }

label { display:block; font-weight:600; margin-bottom:6px; }
input.input, textarea.input {
  width:100%; padding:10px; border:1px solid #dcdcdc;
  border-radius:8px; font-size:14px;
}
textarea.input { min-height:80px; }

.variants { margin:10px 0 18px; }
.variant-row { display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
.variant-row input { flex:1; }

.btn { padding:10px 16px; border-radius:8px; cursor:pointer; border:none; font-size:14px; }
.btn-primary { background:#009688; color:#fff; }
.btn-ghost { background:#fafafa; border:1px solid #e6e6e6; }
.btn-danger { background:#d9534f; color:#fff; }

.actions { display:flex; justify-content:space-between; margin-top:16px; flex-wrap:wrap; }
.link-back { text-decoration:none; color:#009688; }

.note { font-size:13px;color:#666;margin-top:8px; }
</style>
</head>
<body>

<script src="/assets/script/corner-menu.js"></script>

<div class="container-box">
  <h1>Tambah Produk</h1>

  <div id="message" style="color:#b30000;margin-bottom:12px"></div>

  <!-- Form -->
  <div>
    <label>Tokoh (pisah koma)</label>
    <input id="tokoh" class="input" placeholder="Contoh: Custom, Arjuna">

    <div class="form-row">
      <div class="col">
        <label>Ukuran (pisah koma)</label>
        <input id="ukuran" class="input" placeholder="Contoh: miniatur, 20cm">
      </div>
      <div class="col">
        <label>Kualitas</label>
        <input id="kualitas" class="input" placeholder="Contoh: alusan">
      </div>
    </div>

    <label>Link Produk (URL)</label>
    <input id="link" class="input" placeholder="https://...">

    <hr style="margin:18px 0">

    <label>Varian (size dan harga)</label>
    <div id="variants" class="variants"></div>
    <button id="addVariant" class="btn btn-ghost">+ Tambah Varian</button>

    <div class="note">Isikan beberapa varian bila perlu. Minimal 1 varian.</div>

    <div class="actions">
      <a href="/page/admin/products/index.html" class="link-back">← Kembali ke daftar</a>
      <div>
        <button id="btnCancel" class="btn btn-ghost">Batal</button>
        <button id="btnSave" class="btn btn-primary">Simpan Produk</button>
      </div>
    </div>
  </div>
</div>

<script>
// === API KV BARU ===
const API = "https://api.laksanacraft.my.id";
const MSG = document.getElementById("message");

// Cek login
if (!localStorage.getItem("isLoggedIn")) {
  location.href = "/page/login.html";
}

// --- Buat baris variant ---
function createVariantRow(size="", harga=""){
  const row = document.createElement("div");
  row.className = "variant-row";

  const i1 = document.createElement("input");
  i1.className = "input";
  i1.placeholder = "Size (contoh: 20cm)";
  i1.value = size;

  const i2 = document.createElement("input");
  i2.className = "input";
  i2.placeholder = "Harga (contoh: Rp25.000)";
  i2.value = harga;

  const del = document.createElement("button");
  del.className = "btn btn-danger";
  del.textContent = "Hapus";
  del.onclick = () => row.remove();

  row.appendChild(i1);
  row.appendChild(i2);
  row.appendChild(del);

  return row;
}

const variantsBox = document.getElementById("variants");
variantsBox.appendChild(createVariantRow()); // default kosong

document.getElementById("addVariant").onclick = e => {
  e.preventDefault();
  variantsBox.appendChild(createVariantRow());
};

// Cancel
document.getElementById("btnCancel").onclick = e => {
  e.preventDefault();
  location.href = "/page/admin/products/index.html";
};

// === SIMPAN DATA ===
document.getElementById("btnSave").onclick = async (e) => {
  e.preventDefault();
  MSG.textContent = "";

  const tokoh = document.getElementById("tokoh").value.split(",").map(s=>s.trim()).filter(Boolean);
  const ukuran = document.getElementById("ukuran").value.split(",").map(s=>s.trim()).filter(Boolean);
  const kualitas = document.getElementById("kualitas").value.trim();
  const link = document.getElementById("link").value.trim();

  const varian = Array.from(variantsBox.children)
    .map(row => {
      const i = row.querySelectorAll("input");
      return { size: i[0].value.trim(), harga: i[1].value.trim() };
    })
    .filter(v => v.size && v.harga);

  if (!tokoh.length || !ukuran.length || !kualitas || !link) {
    MSG.textContent = "Lengkapi semua field terlebih dahulu.";
    return;
  }

  let current = [];

  try {
    const r = await fetch(`${API}/products`);
    current = await r.json();
    if (!Array.isArray(current)) current = [];
  } catch {
    MSG.textContent = "Gagal mengambil data dari server.";
    return;
  }

  const newId = current.length ? Math.max(...current.map(p => p.id || 0)) + 1 : 1;

  const newItem = { id: newId, tokoh, ukuran, kualitas, link, varian };
  current.push(newItem);

  try {
    const save = await fetch(`${API}/products`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(current, null, 2)
    });

    if (save.ok) {
      location.href = "/page/admin/products/index.html";
    } else {
      MSG.textContent = "Gagal menyimpan ke server.";
    }
  } catch {
    MSG.textContent = "Terjadi error saat menyimpan.";
  }
};
</script>

</body>
</html>